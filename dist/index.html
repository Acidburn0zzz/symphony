<!DOCTYPE html><html lang=en><head><title>IOHK Implementation Example</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata"><style>* {
			padding: 0;
			margin: 0;
		}

		html {
			width: 100%;
			height: 100vh;
			background: #000000;
			overflow: hidden;
		}

		body {
			margin: 0;
			padding: 0;
			font-size: 14px;
			font-family: Inconsolata;
			color: #b6bcbe;
			line-height: 1.3rem;
			overflow: hidden;
		}

		hr {
			display: block;
			height: 1px;
			border: 0;
			border-top: 1px solid #b6bcbe;
			margin: 1em 0;
			padding: 0;
		}

		a {
			color: #cccccc;
		}

		#hud{
			position: absolute;
			padding: 20px;	
		}

		canvas {
			width: 100%!important;
			height: 100%!important;
		}</style></head><body><div id=hud></div><div class=canvas-container><canvas id=stage></canvas></div><script src=//unpkg.com/react@16/umd/react.development.js></script><script src=//unpkg.com/react-dom@16/umd/react-dom.development.js></script><script src=//unpkg.com/babel-standalone@6.15.0/babel.min.js></script><script type=text/babel>window.onload = function(){

			// check that browser supports webgl
			if ( !orpheusApp.canRun ) console.error('Orpheus cannot run :(')
				
			// Create the Orpeus App
			orpheusApp({ path: './static/assets/' }).then( app => {

				window.addEventListener('resize', () => app.setSize(window.innerWidth, window.innerHeight))
				app.setSize(window.innerWidth, window.innerHeight)
				window.app = app


				/*
					Utility methods for navigating along the block chain
				*/
				const goToNextBlock = _ => app.goToBlock(app.state.currentBlock && app.state.currentBlock.next_block)
				const goToPrevBlock = _ => app.goToBlock(app.state.currentBlock && app.state.currentBlock.prev_block)
				window.goToNextBlock = goToNextBlock
				window.goToPrevBlock = goToPrevBlock


				// initial date needs to be set, could be set via current date or url for example
				const Jan1st_2018 = new Date(2018, 0, 1)
				app.setDate(Jan1st_2018) 


				/*
					Destroys the Orpheus instance and unloads all data.
					The application instance cannot be used after this is called
				*/
				// app.destroy()


				/*
					Event called when the first day loads
				*/
				app.on('firstDayLoaded', data => console.log('first day of blocks loaded'))
				

				/*
					Event called as a user scrolls through time and the current day changes
				*/
				app.on('dayChanged', ({ date, input, output, fee }) => {
					ReactDOM.render(		
						<div>	
							<h1>Day View</h1>
							<br/>
							<div>Date: { date.toString() }</div>
							<div>Fee: BTC{ fee.toLocaleString('USD') }</div>
							<div>Total Input Value: BTC{ input.toLocaleString('USD') }</div>
							<div>Total Output Value: BTC{ output.toLocaleString('USD') }</div>
						</div>
					,document.querySelector('#hud'))
				})

				/*
					Event called when a block is hovered over
				*/
				//app.on('blockHovered', console.log )


				/*
					Event called when a block is selected
				*/
				app.on('blockSelected', block => {

					const { bits, fee, feeToInputRatio, hash, height, input, n_tx, output, size, time } = block

					ReactDOM.render(		
						<div>	
							<h1>Block View</h1>
							<br/>
							<div>Date: { time.toString() }</div>
							<div>Bits: { bits.toLocaleString('USD') }</div>
							<div>Fee: BTC{ fee.toLocaleString('USD') }</div>
							<div>Fee Level: { feeToInputRatio }</div>
							<div>Block Hash: { hash.substr(-16) }</div>
							<div>Total Input Value: BTC{ input.toLocaleString('USD') }</div>
							<div>Total Output Value: BTC{ output.toLocaleString('USD') }</div>
							<div >Number of Transactions: { n_tx }</div>				
						</div>
					,document.querySelector('#hud'))
				})

				/*
					Event for whenever a block is unselected
				*/
				app.on('blockUnselected', _ => console.log('BLOCK UNSELECTED'))

				

				// move camera on z axis with mouse wheel
				const onDocumentMouseWheel = function (event) {
					if (app.scrollBlocked) {
						return
					}

					if (app.state.view === 'block') {
						return
					}

					event.preventDefault()

					if (Math.abs(event.deltaY) > 0) {
						app.scrollBlocked = true
						setTimeout(() => {
							app.scrollBlocked = false
						}, 50)
					}

					if (app.stage.targetCameraPos.z < app.state.minCameraZPos) {
						app.stage.targetCameraPos.z = app.state.minCameraZPos
						return
					}

					if (app.stage.targetCameraPos.z > app.state.maxCameraZPos) {
						app.stage.targetCameraPos.z = app.state.maxCameraZPos
						app.stage.targetCameraLookAt.z = app.state.maxCameraZPos - 1000
						return
					}

					if (event.deltaY > 0) {
						app.stage.targetCameraPos.z -= app.stage.cameraMoveStep
						app.stage.targetCameraLookAt.z -= app.stage.cameraMoveStep
					} else if (event.deltaY < 0) {
						app.stage.targetCameraPos.z += app.stage.cameraMoveStep
						app.stage.targetCameraLookAt.z += app.stage.cameraMoveStep
					}
				}

				document.addEventListener("wheel", onDocumentMouseWheel, false);

			})

		}</script><script type=text/javascript src=/static/js/app.js></script></body></html>